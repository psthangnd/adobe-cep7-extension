
var $ = jQuery;
$(document).ready(function () {

	$('#idSearchForm_lb_instrumentation').easySelect();
	$('#idSearchForm_lb_instrumentation').hide();

	//When click pulldown
	$('#idSearchForm_txtinstrumentation').click(function () {

		if ($('#idSearchForm_lb_instrumentation').is(":visible")) {
			$('#idSearchForm_lb_instrumentation').hide();
		}
		else {
			$('#idSearchForm_lb_instrumentation').show();
			$('#idSearchForm_lb_instrumentation').focus();
		}
	})
	//When click select item
	$('#idSearchForm_lb_instrumentation').click(function () {
		if ($(this).val() == null) {
		}
		else if ($(this).val()[0] == "") {
			$('#idSearchForm_lb_instrumentation option:selected').removeAttr("selected");
			$('#idSearchForm_lb_instrumentation').val("");
		}
		else if ($(this).val().length > 1) {
			if ($('#idSearchForm_lb_instrumentation option:first-child').attr('selected')==undefined) {
			}
			else if ($('#idSearchForm_lb_instrumentation option:first-child').attr('selected') = 'selected') {
				$('#idSearchForm_lb_instrumentation option:first-child').attr('selected', "");
			}
		}
		$('#idSearchForm_lb_instrumentation').data('easySelect').refresh();
	})
	//When click Escape button
	$(document).keydown(function (e) {
		var key;
		if (e.which) {
			key = e.which;
		}
		else {
			key = e.keyCode;
		}
		if ($('#idSearchForm_lb_instrumentation').is(":focus")) {
			if (e.keyCode == 65) { // 'A' or 'a'
				return false;
			}
		}
		if (key == 27) {
			if ($('#idSearchForm_lb_instrumentation').is(":visible")) {
				$('#idSearchForm_lb_instrumentation').hide();
			}
		}
	})
});

!(function ($, window, document, undefined) {

	$.easySelect = function (element, options) {

		var plugin = this,
			$element = $(element),
			$options = $element.children('option'),

			list = {

				clear: function () { //clear the list
					list.items.active = 0;
					list.items.collection = null;
				},

				generate: function (refresh) { //generate a list according to options

					var _boxList = '';

					if (refresh) {
						$options = $element.children('option');
					}

					$options.each(function () {
						if ($(this).is(':selected')) { //add selected options to the box
							if ($(this).val() !== "") {
								_boxList += $(this).val() + ',';
							}
						}
					});

					//prepare box items
					if (_boxList == "") {
						$('#idSearchForm_txtinstrumentation').val('選択してください');
					}
					else{
						$('#idSearchForm_txtinstrumentation').val(_boxList.substring(0, _boxList.length - 1));
					}

				}
			};

		plugin.settings = {};

		plugin.init = function () {

			plugin.settings = $.extend({}, options);

			// create & style the stuff
			list.generate();
		};

		plugin.refresh = function () {

			list.generate(true);

		};

		plugin.init();

	};

	$.fn.easySelect = function (options) {
		return this.each(function () {
			if (!$.data(this, "easySelect")) {
				$.data(this, "easySelect", new $.easySelect(this, options));
			}
		});
	};

})(jQuery, window, document);